<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="style.css" />
    <title>Percentator</title>
  </head>
  <body>
    <div id="main-container">
      <div class="header-container">
        <div class="title">
          Percentator
        </div>
      </div>
      <div class="body-container">
        <div class="calculator-container">
          <ul>
            <li class="calc-item">
              <p class="calc-controls">
                What is <input type="number" id="percent" />% of
                <input type="number" id="total-value" />?
              </p>
              <div class="calculate-controls">
                <button id="calculate-percentage" class="button-calculate">
                  Calculate
                </button>
                <input
                  type="text"
                  class="result"
                  id="percent-result"
                  readonly
                />
              </div>
            </li>
            <li class="calc-item">
              <p class="calc-controls">
                <input type="number" id="value-2" /> is what percentage of
                <input type="number" id="total-2" />?
              </p>
              <div class="calculate-controls">
                <button class="button-calculate" id="calculate-percentage-2">
                  Calculate
                </button>
                <input
                  type="text"
                  class="result"
                  id="percent-result-2"
                  readonly
                />
              </div>
            </li>
            <li class="calc-item">
              <p class="calc-controls">
                What is the percentage increase/decrease from <br />
                <input type="number" id="start-value" /> to
                <input type="number" id="end-value" />?
              </p>
              <div class="calculate-controls">
                <button id="calculate-percentage-3" class="button-calculate">
                  Calculate
                </button>
                <input
                  type="text"
                  class="result"
                  id="percent-result-3"
                  readonly
                />
              </div>
            </li>
          </ul>
          <div class="info-container">
            <p class="info-text">
              <b>Tips:</b> Use tab to move to the next field. Use shift-tab to
              move to the previous field. Press enter to calculate.
            </p>
          </div>
        </div>
        <div class="chart-container">
          <svg viewBox="0 0 36 36" class="circular-chart">
            <path
              class="circle-bg"
              d="M18 2.0845
                  a 15.9155 15.9155 0 0 1 0 31.831
                  a 15.9155 15.9155 0 0 1 0 -31.831"
            />
            <path
              class="circle"
              stroke-dasharray="0, 100"
              d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
            />
            <text x="18" y="20.35" class="chart-result-text">0%</text>
          </svg>
        </div>
      </div>
      <div class="footer-container">
        <b>&copy; 2020</b>
      </div>
    </div>

    <script>
      window.onload = configureControls();

      function formatChartResult(num) {
        return Math.abs(num) > 999999
          ? Math.sign(num) * (Math.abs(num) / 1000000).toFixed(1) + "M"
          : Math.abs(num) > 999
          ? Math.sign(num) * (Math.abs(num) / 1000).toFixed(1) + "k"
          : num % 1 === 0
          ? num
          : num.toFixed(2);
      }

      const setChartText = text => {
        const chartText = document.querySelector(".chart-result-text");
        chartText.innerHTML = text;
      };

      const clearChart = () => {
        let circle = document.querySelector(".circle");
        circle.style.strokeDasharray = [0, 100];
        setChartText("0%");
      };

      const displayChart = result => {
        let circle = document.querySelector(".circle");
        circle.style.strokeDasharray = [result, 100];
      };

      const showResult = (result, id) => {
        let resultField = document.getElementById(id);
        resultField.value = result;
      };

      const calculatePercentage = () => {
        let percentage = document.getElementById("percent").value;
        let totalValue = document.getElementById("total-value").value;
        let result = (percentage * totalValue) / 100;
        showResult(result, "percent-result");
        displayChart(0);
        setChartText("0%");
      };

      const calculatePercentage2 = () => {
        let value = document.getElementById("value-2").value;
        let total = document.getElementById("total-2").value;
        if (!value || !total) {
          setChartText("0%");
          displayChart(0);
          return false;
        }
        let result = (value / total) * 100;
        showResult(result, "percent-result-2");
        displayChart(result);
        setChartText(`${formatChartResult(result)}%`);
      };

      const calculatePercentage3 = () => {
        const startValue = document.getElementById("start-value").value;
        const endValue = document.getElementById("end-value").value;
        const result = ((startValue - endValue) / startValue) * 100 * -1;
        console.log(result);
        showResult(result, "percent-result-3");
        displayChart(result);
        setChartText(`${formatChartResult(result)}%`);
      };

      function calculateResult(event) {
        let id = event.target.id;
        if (id === "calculate-percentage") {
          calculatePercentage();
        } else if (id === "calculate-percentage-2") {
          calculatePercentage2();
        } else if (id === "calculate-percentage-3") {
          calculatePercentage3();
        }
      }

      function configureControls() {
        let calculateButtons = document.querySelectorAll(".button-calculate");
        calculateButtons.forEach(button => {
          button.addEventListener("click", calculateResult);
        });
      }
    </script>
  </body>
</html>
